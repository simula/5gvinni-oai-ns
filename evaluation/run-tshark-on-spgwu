#!/bin/bash

INTERFACES="ens5 ens6 pdn any"
DURATION=60

for interface in $INTERFACES ; do
   rm -f /tmp/$interface.pcap /tmp/$interface.pcap.gz
   tshark -q -i $interface -w /tmp/$interface.pcap --autostop duration:$DURATION -f 'icmp or udp' &
done
multiInterfaces=""
args=""
for interface in $INTERFACES ; do
   if [ "$interface" != "any" ] ; then
      multiInterfaces="$multiInterfaces $interface"
      args="$args -i $interface"
   fi
done
rm -f /tmp/multi.pcap /tmp/multi.pcap.gz
tshark -q $args -w /tmp/multi.pcap --autostop duration:$DURATION -f 'icmp or udp' & 

echo "Sleeping ..."
wait
echo "Done!"

for interface in $INTERFACES multi ; do
   gzip -9 /tmp/$interface.pcap
   chown nornetpp:nornetpp /tmp/$interface.pcap.gz
   ls -l /tmp/$interface.pcap.gz
done
