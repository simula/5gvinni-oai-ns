vnfd:
# =====================================================================
#     #######  #####          #     #   ###   #     # #     #   ###
#     #       #     #         #     #    #    ##    # ##    #    #
#     #       #               #     #    #    # #   # # #   #    #
#      #####  #  ####  #####  #     #    #    #  #  # #  #  #    #
#           # #     #          #   #     #    #   # # #   # #    #
#     #     # #     #           # #      #    #    ## #    ##    #
#      #####   #####             #      ###   #     # #     #   ###
# =====================================================================
#
# SimulaMet OpenAirInterface Evolved Packet Core VNF
# Copyright (C) 2019-2023 by Thomas Dreibholz
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
# Contact: dreibh@simula.no

    description: SimulaMet OpenAirInterface Evolved Packet Core VNF
    df:
    -   id: default-df
        instantiation-level:
        -   id: default-instantiation-level
            vdu-level:
            -   number-of-instances: 1
                vdu-id: HSS
            -   number-of-instances: 1
                vdu-id: MME
            -   number-of-instances: 1
                vdu-id: SPGW-C
            -   number-of-instances: 1
                vdu-id: SPGW-U


        # ###### VNF configuration ##########################################

        lcm-operations-configuration:
            operate-vnf-op-config:
                day1-2:

                # ###### VDU: HSS (Home Subscriber Server) ##################
                -   id: HSS
                    initial-config-primitive:
                    -   name: config
                        execution-environment-ref: hsscharm-ee
                        parameter:
                        -   name: ssh-hostname
                            value: <rw_mgmt_ip>
                        -   name: ssh-username
                            value: nornetpp
                        -   name: ssh-password
                            value: <password>
                        seq: '1'
                    -   name: prepare-cassandra-hss-build
                        execution-environment-ref: hsscharm-ee
                        parameter:
                        -   name: hss-git-repository
                            value: <hss_git_repository>
                        -   name: hss-git-commit
                            value: <hss_git_commit>
                        seq: '2'
                    -   name: configure-cassandra
                        execution-environment-ref: hsscharm-ee
                        parameter:
                        -   name: cassandra-server-ip
                            value: 172.16.6.129
                        seq: '3'
                    -   name: configure-hss
                        execution-environment-ref: hsscharm-ee
                        parameter:
                        -   name: cassandra-server-ip
                            value: 172.16.6.129
                        -   name: hss-S6a-address
                            value: <hss_S6a_address>
                        -   name: mme-S6a-address
                            value: <mme_S6a_address>
                        -   name: network-realm
                            value: <network_realm>
                        -   name: network-op
                            value: <network_op>
                        -   name: network-k
                            value: <network_k>
                        -   name: network-imsi-first
                            value: <network_imsi_first>
                        -   name: network-msisdn-first
                            value: <network_msisdn_first>
                        -   name: network-users
                            value: <network_users>
                        seq: '4'
                    -   name: restart-hss
                        execution-environment-ref: hsscharm-ee
                        seq: '5'
                    execution-environment-list:
                    - id: hsscharm-ee
                      juju:
                          charm: hsscharm
                    metrics:
                    -   name: system_random
                    -   name: system_uptime
                    -   name: system_users
                    -   name: cpu_processes
                    -   name: cpu_load_current
                    -   name: cpu_load_1min
                    -   name: cpu_load_5min
                    -   name: cpu_load_15min
                    -   name: memory_ram_usage
                    -   name: memory_swap_usage
                    -   name: disk_usage
                    -   name: network_mgmt_bytes_in
                    -   name: network_mgmt_packets_in
                    -   name: network_mgmt_bytes_out
                    -   name: network_mgmt_packets_out
                    -   name: network_S6a_bytes_in
                    -   name: network_S6a_packets_in
                    -   name: network_S6a_bytes_out
                    -   name: network_S6a_packets_out


                # ###### VDU: MME (Mobility Management Entity) ##############
                -   id: MME
                    initial-config-primitive:
                    -   name: config
                        execution-environment-ref: mmecharm-ee
                        parameter:
                        -   name: ssh-hostname
                            value: <rw_mgmt_ip>
                        -   name: ssh-username
                            value: nornetpp
                        -   name: ssh-password
                            value: <password>
                        seq: '1'
                    -   name: prepare-mme-build
                        execution-environment-ref: mmecharm-ee
                        parameter:
                        -   name: mme-git-repository
                            value: <mme_git_repository>
                        -   name: mme-git-commit
                            value: <mme_git_commit>
                        -   name: mme-S1C-ipv4-interface
                            value: <mme_S1C_ipv4_interface>
                        -   name: mme-S1C-ipv4-gateway
                            value: <mme_S1C_ipv4_gateway>
                        -   name: mme-S1C-ipv6-interface
                            value: <mme_S1C_ipv6_interface>
                        -   name: mme-S1C-ipv6-gateway
                            value: <mme_S1C_ipv6_gateway>
                        seq: '2'
                    -   name: configure-mme
                        execution-environment-ref: mmecharm-ee
                        parameter:
                        -   name: mme-S1C-ipv4-interface
                            value: <mme_S1C_ipv4_interface>
                        -   name: mme-S11-ipv4-interface
                            value: <mme_S11_ipv4_interface>
                        -   name: spgwc-S11-ipv4-interface
                            value: <spgwc_S11_ipv4_interface>
                        -   name: hss-S6a-address
                            value: <hss_S6a_address>
                        -   name: network-realm
                            value: <network_realm>
                        -   name: network-mcc
                            value: <network_mcc>
                        -   name: network-mnc
                            value: <network_mnc>
                        -   name: network-op
                            value: <network_op>
                        -   name: network-k
                            value: <network_k>
                        -   name: network-imsi-first
                            value: <network_imsi_first>
                        -   name: network-msisdn-first
                            value: <network_msisdn_first>
                        -   name: network-users
                            value: <network_users>
                        seq: '3'
                    -   name: restart-mme
                        execution-environment-ref: mmecharm-ee
                        seq: '4'
                    execution-environment-list:
                    - id: mmecharm-ee
                      juju:
                        charm: mmecharm
                    metrics:
                    -   name: system_random
                    -   name: system_uptime
                    -   name: system_users
                    -   name: cpu_processes
                    -   name: cpu_load_current
                    -   name: cpu_load_1min
                    -   name: cpu_load_5min
                    -   name: cpu_load_15min
                    -   name: memory_ram_usage
                    -   name: memory_swap_usage
                    -   name: disk_usage
                    -   name: network_mgmt_bytes_in
                    -   name: network_mgmt_packets_in
                    -   name: network_mgmt_bytes_out
                    -   name: network_mgmt_packets_out
                    -   name: network_S6a_bytes_in
                    -   name: network_S6a_packets_in
                    -   name: network_S6a_bytes_out
                    -   name: network_S6a_packets_out
                    -   name: network_S11_bytes_in
                    -   name: network_S11_packets_in
                    -   name: network_S11_bytes_out
                    -   name: network_S11_packets_out
                    -   name: network_S1C_packets_in
                    -   name: network_S1C_bytes_out
                    -   name: network_S1C_packets_out


                # ###### VDU: SPGW-C ########################################
                # (Serving & Packet Data Network Gateway -- Control Plane)
                -   id: SPGW-C
                    initial-config-primitive:
                    -   name: config
                        execution-environment-ref: spgwccharm-ee
                        parameter:
                        -   name: ssh-hostname
                            value: <rw_mgmt_ip>
                        -   name: ssh-username
                            value: nornetpp
                        -   name: ssh-password
                            value: <password>
                        seq: '1'
                    -   name: prepare-spgwc-build
                        execution-environment-ref: spgwccharm-ee
                        parameter:
                        -   name: spgwc-git-repository
                            value: <spgwc_git_repository>
                        -   name: spgwc-git-commit
                            value: <spgwc_git_commit>
                        seq: '2'
                    -   name: configure-spgwc
                        execution-environment-ref: spgwccharm-ee
                        parameter:
                        -   name: network-realm
                            value: <network_realm>
                        -   name: network-ipv4-dns1
                            value: <network_ipv4_dns1>
                        -   name: network-ipv4-dns2
                            value: <network_ipv4_dns2>
                        -   name: network-ipv4-ue-address-pool
                            value: <network_ipv4_ue_address_pool>
                        seq: '3'
                    -   name: restart-spgwc
                        execution-environment-ref: spgwccharm-ee
                        seq: '4'
                    execution-environment-list:
                    - id: spgwccharm-ee
                      juju:
                        charm: spgwccharm
                    metrics:
                    -   name: system_random
                    -   name: system_uptime
                    -   name: system_users
                    -   name: cpu_processes
                    -   name: cpu_load_current
                    -   name: cpu_load_1min
                    -   name: cpu_load_5min
                    -   name: cpu_load_15min
                    -   name: memory_ram_usage
                    -   name: memory_swap_usage
                    -   name: disk_usage
                    -   name: network_mgmt_bytes_in
                    -   name: network_mgmt_packets_in
                    -   name: network_mgmt_bytes_out
                    -   name: network_mgmt_packets_out
                    -   name: network_SXab_bytes_in
                    -   name: network_SXab_packets_in
                    -   name: network_SXab_bytes_out
                    -   name: network_SXab_packets_out
                    -   name: network_S11_bytes_in
                    -   name: network_S11_packets_in
                    -   name: network_S11_bytes_out
                    -   name: network_S11_packets_out


                # ###### VDU: SPGW-U ########################################
                # (Serving & Packet Data Network Gateway -- User Plane)
                -   id: SPGW-U
                    initial-config-primitive:
                    -   name: config
                        execution-environment-ref: spgwucharm-ee
                        parameter:
                        -   name: ssh-hostname
                            value: <rw_mgmt_ip>
                        -   name: ssh-username
                            value: nornetpp
                        -   name: ssh-password
                            value: <password>
                        seq: '1'
                    -   name: prepare-spgwu-build
                        execution-environment-ref: spgwucharm-ee
                        parameter:
                        -   name: spgwu-git-repository
                            value: <spgwu_git_repository>
                        -   name: spgwu-git-commit
                            value: <spgwu_git_commit>
                        -   name: spgwu-S1U-ipv4-interface
                            value: <spgwu_S1U_ipv4_interface>
                        -   name: spgwu-S1U-ipv4-gateway
                            value: <spgwu_S1U_ipv4_gateway>
                        -   name: spgwu-SGi-ipv4-interface
                            value: <spgwu_SGi_ipv4_interface>
                        -   name: spgwu-SGi-ipv4-gateway
                            value: <spgwu_SGi_ipv4_gateway>
                        -   name: spgwu-SGi-ipv6-interface
                            value: <spgwu_SGi_ipv6_interface>
                        -   name: spgwu-SGi-ipv6-gateway
                            value: <spgwu_SGi_ipv6_gateway>
                        seq: '2'
                    -   name: configure-spgwu
                        execution-environment-ref: spgwucharm-ee
                        parameter:
                        -   name: spgwu-spgwc-list
                            value: <spgwu_spgwc_list>
                        seq: '3'
                    -   name: restart-spgwu
                        execution-environment-ref: spgwucharm-ee
                        seq: '4'
                    execution-environment-list:
                    - id: spgwucharm-ee
                      juju:
                        charm: spgwucharm
                    metrics:
                    -   name: system_random
                    -   name: system_uptime
                    -   name: system_users
                    -   name: cpu_processes
                    -   name: cpu_load_current
                    -   name: cpu_load_1min
                    -   name: cpu_load_5min
                    -   name: cpu_load_15min
                    -   name: memory_ram_usage
                    -   name: memory_swap_usage
                    -   name: disk_usage
                    -   name: network_mgmt_bytes_in
                    -   name: network_mgmt_packets_in
                    -   name: network_mgmt_bytes_out
                    -   name: network_mgmt_packets_out
                    -   name: network_SXab_bytes_in
                    -   name: network_SXab_packets_in
                    -   name: network_SXab_bytes_out
                    -   name: network_SXab_packets_out
                    -   name: network_S1U_bytes_in
                    -   name: network_S1U_packets_in
                    -   name: network_S1U_bytes_out
                    -   name: network_S1U_packets_out
                    -   name: network_SGi_bytes_in
                    -   name: network_SGi_packets_in
                    -   name: network_SGi_bytes_out
                    -   name: network_SGi_packets_out

        vdu-profile:
        -   id: HSS
            min-number-of-instances: 1
        -   id: MME
            min-number-of-instances: 1
        -   id: SPGW-C
            min-number-of-instances: 1
        -   id: SPGW-U
            min-number-of-instances: 1


        # ###### Internal VLDs ##############################################

        # ====== Network Address Ranges of the Internal Networks ============
        virtual-link-profile:
        -   flavour: ''
            id: s6a
            virtual-link-protocol-data:
                l3-protocol-data:
                    cidr: 172.16.6.0/24
                    description: S6a Network
                    dhcp-enabled: true
                    ip-version: ipv4
                    name: s6a-l3-protocol-data
        -   flavour: ''
            id: s11
            virtual-link-protocol-data:
                l3-protocol-data:
                    cidr: 172.16.1.0/24
                    description: S11 Network
                    dhcp-enabled: true
                    ip-version: ipv4
                    name: s11-l3-protocol-data
        -   flavour: ''
            id: sxab
            virtual-link-protocol-data:
                l3-protocol-data:
                    cidr: 172.55.55.0/24
                    description: SXab Network
                    dhcp-enabled: true
                    ip-version: ipv4
                    name: sxab-l3-protocol-data


    # ###### External Connection Points ###################################

    ext-cpd:
    -   id: hss-mgmt-cp-ext
        int-cpd:
            cpd: ens3-int
            vdu-id: HSS
    -   id: mme-mgmt-cp-ext
        int-cpd:
            cpd: ens3-int
            vdu-id: MME
    -   id: mme-s1c-cp-ext
        int-cpd:
            cpd: ens6-int
            vdu-id: MME
    -   id: spgwc-mgmt-cp-ext
        int-cpd:
            cpd: ens3-int
            vdu-id: SPGW-C
    -   id: spgwu-mgmt-cp-ext
        int-cpd:
            cpd: ens3-int
            vdu-id: SPGW-U
    -   id: spgwu-s1u-cp-ext
        int-cpd:
            cpd: ens5-int
            vdu-id: SPGW-U
        port-security-enabled: false
    -   id: spgwu-sgi-cp-ext
        int-cpd:
            cpd: ens6-int
            vdu-id: SPGW-U
        port-security-enabled: false

    id: SimulaMet-OAI-EPC_vnfd
    int-virtual-link-desc:
    -   id: s6a
    -   id: s11
    -   id: sxab
    mgmt-cp: mme-mgmt-cp-ext
    product-name: SimulaMet-OAI-EPC_vnfd
    provider: Thomas Dreibholz


    # ###### VDU: Configuration #############################################

    sw-image-desc:
    -   id: 5gVINNI-OpenStack-Ubuntu-18.04-LTS
        image: 5gVINNI-OpenStack-Ubuntu-18.04-LTS
        name: 5gVINNI-OpenStack-Ubuntu-18.04-LTS
    vdu:
    -   cloud-init-file: hss-init
        description: HSS
        id: HSS
        int-cpd:
        -   id: ens3-int
            virtual-network-interface-requirement:
            -   name: ens3
                virtual-interface:
                    type: PARAVIRT
        -   id: ens4-int
            int-virtual-link-desc: s6a
            virtual-network-interface-requirement:
            -   name: ens4
                virtual-interface:
                    type: PARAVIRT
        name: HSS
        sw-image-desc: 5gVINNI-OpenStack-Ubuntu-18.04-LTS
        virtual-compute-desc: HSS-compute
        virtual-storage-desc:
        - HSS-storage
    -   cloud-init-file: mme-init
        description: MME
        id: MME
        int-cpd:
        -   id: ens3-int
            virtual-network-interface-requirement:
            -   name: ens3
                virtual-interface:
                    type: PARAVIRT
        -   id: ens4-int
            int-virtual-link-desc: s6a
            virtual-network-interface-requirement:
            -   name: ens4
                virtual-interface:
                    type: PARAVIRT
        -   id: ens5-int
            int-virtual-link-desc: s11
            virtual-network-interface-requirement:
            -   name: ens5
                virtual-interface:
                    type: PARAVIRT
        -   id: ens6-int
            virtual-network-interface-requirement:
            -   name: ens6
                virtual-interface:
                    type: PARAVIRT
        name: MME
        sw-image-desc: 5gVINNI-OpenStack-Ubuntu-18.04-LTS
        virtual-compute-desc: MME-compute
        virtual-storage-desc:
        - MME-storage
    -   cloud-init-file: spgwc-init
        description: SPGW-C
        id: SPGW-C
        int-cpd:
        -   id: ens3-int
            virtual-network-interface-requirement:
            -   name: ens3
                virtual-interface:
                    type: PARAVIRT
        -   id: ens4-int
            int-virtual-link-desc: sxab
            virtual-network-interface-requirement:
            -   name: ens4
                virtual-interface:
                    type: PARAVIRT
        -   id: ens5-int
            int-virtual-link-desc: s11
            virtual-network-interface-requirement:
            -   name: ens5
                virtual-interface:
                    type: PARAVIRT
        name: SPGW-C
        sw-image-desc: 5gVINNI-OpenStack-Ubuntu-18.04-LTS
        virtual-compute-desc: SPGW-C-compute
        virtual-storage-desc:
        - SPGW-C-storage
    -   cloud-init-file: spgwu-init
        description: SPGW-U
        id: SPGW-U
        int-cpd:
        -   id: ens3-int
            virtual-network-interface-requirement:
            -   name: ens3
                virtual-interface:
                    type: PARAVIRT
        -   id: ens4-int
            int-virtual-link-desc: sxab
            virtual-network-interface-requirement:
            -   name: ens4
                virtual-interface:
                    type: PARAVIRT
        -   id: ens5-int
            virtual-network-interface-requirement:
            -   name: ens5
                virtual-interface:
                    type: PARAVIRT
        -   id: ens6-int
            virtual-network-interface-requirement:
            -   name: ens6
                virtual-interface:
                    type: PARAVIRT
        name: SPGW-U
        sw-image-desc: 5gVINNI-OpenStack-Ubuntu-18.04-LTS
        virtual-compute-desc: SPGW-U-compute
        virtual-storage-desc:
        - SPGW-U-storage
    version: '1.0'
    virtual-compute-desc:
    -   id: HSS-compute
        virtual-cpu:
            num-virtual-cpu: 4
        virtual-memory:
            size: 3.0
    -   id: MME-compute
        virtual-cpu:
            num-virtual-cpu: 4
        virtual-memory:
            size: 2.0
    -   id: SPGW-C-compute
        virtual-cpu:
            num-virtual-cpu: 4
        virtual-memory:
            size: 3.0
    -   id: SPGW-U-compute
        virtual-cpu:
            num-virtual-cpu: 4
        virtual-memory:
            size: 3.0
    virtual-storage-desc:
    -   id: HSS-storage
        size-of-storage: 64
    -   id: MME-storage
        size-of-storage: 64
    -   id: SPGW-C-storage
        size-of-storage: 64
    -   id: SPGW-U-storage
        size-of-storage: 64
